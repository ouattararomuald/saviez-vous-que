plugins {
  id 'com.android.application'
  id 'kotlin-android'
  id 'kotlin-parcelize'
  id 'kotlin-kapt'
  id 'androidx.navigation.safeargs'
}

android {
  compileSdkVersion buildConfig.compileSdk

  defaultConfig {
    applicationId "com.ouattararomuald.saviezvousque"
    minSdkVersion buildConfig.minSdk
    targetSdkVersion buildConfig.targetSdk
    versionCode 18
    versionName '3.2.2'

    testInstrumentationRunner 'androidx.test.runner.AndroidJUnitRunner'

    vectorDrawables.useSupportLibrary true

    resConfigs 'fr'
  }

  packagingOptions {
    exclude 'META-INF/kotlinx-coroutines-core.kotlin_module'
  }

  compileOptions {
    sourceCompatibility JavaVersion.VERSION_11
    targetCompatibility JavaVersion.VERSION_11
  }

  kotlinOptions {
    jvmTarget = JavaVersion.VERSION_11.toString()
    useIR = true
  }

  testOptions {
    unitTests {
      includeAndroidResources = true
    }
  }

  buildFeatures {
    viewBinding true
  }

  lintOptions {
    textReport true
    textOutput 'stdout'

    // InvalidPackage: Needed cause of SimpleXml
    disable 'AllowBackup', 'InvalidPackage', 'GoogleAppIndexingWarning' // We don't care
  }

  buildTypes {
    def DATABASE_NAME_KEY = 'DATABASE_NAME'
    def FEED_BASE_URL = '"http://saviezvousque.net/wp-json/wp/v2/"'
    def FEED_BASE_URL_KEY = 'FEED_BASE_URL'

    debug {
      buildConfigField 'String', DATABASE_NAME_KEY, '"svqDbDebug"'
      buildConfigField 'String', FEED_BASE_URL_KEY, FEED_BASE_URL

      applicationIdSuffix '.debug'
    }

    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'

      buildConfigField 'String', DATABASE_NAME_KEY, '"HaveFun"'
      buildConfigField 'String', FEED_BASE_URL_KEY, FEED_BASE_URL
    }
  }
}

dependencies {
  implementation fileTree(include: ['*.jar'], dir: 'libs')
  implementation deps.kotlin.stdlib.jdk8
  implementation project(':db')
  implementation project(':downloaders')

  implementation deps.coroutines.core

  implementation deps.dagger.runtime
  kapt deps.dagger.compiler

  implementation deps.androidx.appcompat
  implementation deps.androidx.constraintlayout
  implementation deps.androidx.legacy
  implementation deps.androidx.material
  implementation deps.androidx.recyclerview
  implementation deps.androidx.annotation
  implementation deps.androidx.vectordrawable
  implementation deps.androidx.arch.core.ktx

  implementation deps.androidx.databinding.library
  kapt deps.androidx.databinding.compiler

  implementation deps.androidx.arch.lifecycle.extensions
  implementation deps.androidx.arch.lifecycle.java8
  implementation deps.androidx.arch.lifecycle.reactivestreams

  implementation deps.groupie.core
  implementation deps.groupie.viewbinding

  implementation deps.picasso

  implementation deps.stetho

  implementation deps.rxAndroid

  implementation deps.retrofit.rxjavaCallAdapter
  implementation deps.retrofit.gsonConverter

  testImplementation deps.junit
  testImplementation deps.coroutines.test
  testImplementation deps.robolectric
  testImplementation deps.truth

  androidTestImplementation deps.junit
  androidTestImplementation deps.androidx.test.ext.junit
  androidTestImplementation deps.androidx.test.ext.junitKtx
  androidTestImplementation deps.androidx.test.espresso.runner
  androidTestImplementation deps.androidx.test.espresso.core
  androidTestImplementation deps.androidx.paging.testing
  androidTestImplementation deps.mockito
  androidTestImplementation deps.truth
}
